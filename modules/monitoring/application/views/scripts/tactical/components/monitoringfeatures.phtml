<?php

$summary = $this->statusSummary;
$total_services = $summary->services_active + $summary->services_passive + $summary->services_not_checked;
$total_hosts = $summary->hosts_active + $summary->hosts_passive + $summary->hosts_not_checked;

$services_without_flap_detection = $total_services - $summary->services_with_flap_detection;
$hosts_without_flap_detection = $total_hosts - $summary->hosts_with_flap_detection;
$non_flapping_services = $total_services - $summary->services_flapping;
$non_flapping_hosts = $total_hosts - $summary->hosts_flapping;
$hosts_not_triggering_notifications = $total_hosts - $summary->hosts_triggering_notifications;
$services_not_triggering_notifications = $total_services - $summary->services_triggering_notifications;
$hosts_not_processing_event_handlers = $total_hosts - $summary->hosts_processing_event_handlers;
$services_not_processing_event_handlers = $total_services - $summary->services_processing_event_handlers;

?>
<div class="box monitoringfeatures">
    <h2><?= $this->translate('Monitoring Features'); ?></h2>
    <div class="box contents">
        <div class="box-separator"><?= $this->translate('Flap detection'); ?></div>
        <table>
            <tbody>
                <tr>
                    <td>
<?php if ($hosts_without_flap_detection): ?>
                        <div class="box entry feature_disabled">
                            <a href="<?= $this->href(
                                'monitoring/list/hosts',
                                array('host_flap_detection_enabled' => 0)
                            ); ?>">
                                <?= sprintf('%d hosts disabled', $hosts_without_flap_detection); ?>
                            </a>
<?php else: ?>
                        <div class="box entry feature_enabled">
                            <a href="<?= $this->href(
                                'monitoring/list/hosts',
                                array('host_flap_detection_enabled' => 1)
                            ); ?>">
                                <?= $this->translate('All hosts enabled'); ?>
                            </a>
<?php endif ?>
<?php if ($summary->hosts_flapping): ?>
                            <a href="<?= $this->href(
                                'monitoring/list/hosts',
                                array('host_is_flapping' => 1)
                            ); ?>" style="color: red;">
                                <?= sprintf('%d hosts flapping', $summary->hosts_flapping); ?>
                            </a>
<?php endif ?>
                        </div>
                    </td>
                    <td>
<?php if ($services_without_flap_detection): ?>
                        <div class="box entry feature_disabled">
                            <a href="<?= $this->href(
                                'monitoring/list/services',
                                array('service_flap_detection_enabled' => 0)
                            ); ?>">
                                <?= sprintf('%d services disabled', $services_without_flap_detection); ?>
                            </a>
<?php else: ?>
                        <div class="box entry feature_enabled">
                            <a href="<?= $this->href(
                                'monitoring/list/services',
                                array('service_flap_detection_enabled' => 1)
                            ); ?>">
                                <?= $this->translate('All services enabled'); ?>
                            </a>
<?php endif ?>
<?php if ($summary->services_flapping): ?>
                            <a href="<?= $this->href(
                                'monitoring/list/services',
                                array('service_is_flapping' => 1)
                            ); ?>" style="color: red;">
                                <?= sprintf('%d services flapping', $summary->services_flapping); ?>
                            </a>
<?php endif ?>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <div class="box-separator"><?= $this->translate('Notifications'); ?></div>
        <table>
            <tbody>
                <tr>
                    <td>
<?php if ($hosts_not_triggering_notifications): ?>
                        <div class="box entry feature_disabled">
                            <a href="<?= $this->href(
                                'monitoring/list/hosts',
                                array('host_notifications_enabled' => 0)
                            ); ?>">
                                <?= sprintf('%d hosts disabled', $hosts_not_triggering_notifications); ?>
                            </a>
<?php else: ?>
                        <div class="box entry feature_enabled">
                            <a href="<?= $this->href(
                                'monitoring/list/hosts',
                                array('host_notifications_enabled' => 1)
                            ); ?>">
                                <?= $this->translate('All hosts enabled'); ?>
                            </a>
<?php endif ?>
                        </div>
                    </td>
                    <td>
<?php if ($services_not_triggering_notifications): ?>
                        <div class="box entry feature_disabled">
                            <a href="<?= $this->href(
                                'monitoring/list/services',
                                array('service_notifications_enabled' => 0)
                            ); ?>">
                                <?= sprintf('%d services disabled', $services_not_triggering_notifications); ?>
                            </a>
<?php else: ?>
                        <div class="box entry feature_enabled">
                            <a href="<?= $this->href(
                                'monitoring/list/services',
                                array('service_notifications_enabled' => 1)
                            ); ?>">
                                <?= $this->translate('All services enabled'); ?>
                            </a>
<?php endif ?>
                        </div>
                    </td> 
                </tr>
            </tbody>
        </table>
        <div class="box-separator"><?= $this->translate('Event handlers'); ?></div>
        <table>
            <tbody>
                <tr>
                    <td>
<?php if ($hosts_not_processing_event_handlers): ?>
                        <div class="box entry feature_disabled">
                            <a href="<?= $this->href(
                                'monitoring/list/hosts',
                                array('host_event_handler_enabled' => 0)
                            ); ?>">
                                <?= sprintf('%d hosts disabled', $hosts_not_processing_event_handlers); ?>
                            </a>
<?php else: ?>
                        <div class="box entry feature_enabled">
                            <a href="<?= $this->href(
                                'monitoring/list/hosts',
                                array('host_event_handler_enabled' => 1)
                            ); ?>">
                                <?= $this->translate('All hosts enabled'); ?>
                            </a>
<?php endif ?>
                        </div>
                    </td>
                    <td>
<?php if ($services_not_processing_event_handlers): ?>
                        <div class="box entry feature_disabled">
                            <a href="<?= $this->href(
                                'monitoring/list/services',
                                array('service_event_handler_enabled' => 0)
                            ); ?>">
                                <?= sprintf('%d services disabled', $services_not_processing_event_handlers); ?>
                            </a>
<?php else: ?>
                        <div class="box entry feature_enabled">
                            <a href="<?= $this->href(
                                'monitoring/list/services',
                                array('service_event_handler_enabled' => 1)
                            ); ?>">
                                <?= $this->translate('All services enabled'); ?>
                            </a>
<?php endif ?>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
