<?php
$commandHelper = $this->getHelper('CommandForm');
?>

<div data-icinga-component="app/mainDetailGrid" data-icinga-grid-selection-type="single">
  <div>
    <?=  $this->sortControl->render($this); ?>
  </div>
  <div>
    <?= $this->paginationControl($downtimes, null, null, array('preserve' => $this->preserve)); ?>
    <table class="table table-condensed">
      <tbody>
      <?php foreach ($downtimes as $downtime): ?>
      <tr>
        <td>
          <?= $this->dateFormat()->formatDateTime((int) $downtime->downtime_start); ?> -
          <?= $this->dateFormat()->formatDateTime((int) $downtime->downtime_end); ?>
          <br />
          <small>Duration: <?= $this->util()->showHourMin((int) $downtime->downtime_duration); ?></small>
          <br />
          <small>The <?php if($downtime->downtime_is_flexible): ?>flexible<?php else: ?>fixed<?php endif; ?> downtime is <?php if(!$downtime->downtime_is_in_effect): ?>not <?php endif; ?>in effect</small>
        </td>
        <td>
          <?php if (isset($downtime->service)): ?>
            <a href="<?= $this->href('monitoring/show/service', array(
              'host'    => $downtime->host,
              'service' => $downtime->service
            )); ?>"><?= $downtime->service ?></a>
            <small>on <?= $downtime->host ?></small>
          <?php else: ?>
            <a href="<?= $this->href('monitoring/show/host', array(
              'host'    => $downtime->host
            )); ?>"><?= $downtime->host ?></a>
          <?php endif; ?>
          <br />
          <?= $downtime->downtime_author ?>: <?= $downtime->downtime_comment ?>
          <br />
          <small>Entry Time: <?= $downtime->downtime_entry_time ?></small>
        <td>
            <?php
              $data = array(
                'downtimeid'    => $downtime->downtime_internal_downtime_id,
                'host'          => $downtime->host
              );
              if (isset($downtime->service)) {
                $data['service'] = $downtime->service;
              }
              echo $commandHelper->iconSubmitForm(
                'icinga-icon-remove',
                'Remove Downtime',
                'btn-small',
                'removedowntime',
                $data
              );
            ?>
        </td>
      </tr>
      <?php endforeach ?>
      </tbody>
    </table>
    <?= $this->paginationControl($downtimes, null, null, array('preserve' => $this->preserve)); ?>
  </div>
</div>
