<?php

use Icinga\Data\Filter\Filter;

?><div class="controls">
<?= $this->tabs ?>
<h1>History - Critical Events</h1>
</div>
<div class="content" data-base-target="_next">
<?php

$grid->setColor('#FC0707');
$data = array();

if (count($summary) === 0) {
    echo t('No history entry matching the filter');
}
foreach ($summary as $entry) {
    $day = $entry->day;
    $value = $entry->cnt_critical;
    $caption =  $value . ' ' .
        t('critical events on ') . $this->dateFormat()->formatDate(strtotime($day));
    $filter = Filter::matchAll(
        Filter::expression('timestamp', '<', strtotime($day . ' 23:59:59')),
        Filter::expression('timestamp', '>', strtotime($day . ' 00:00:00')),
        Filter::expression('object_type', '=', 'service'),
        Filter::expression('state', '=', '2'),
        Filter::matchAny(
            Filter::expression('type', '=', 'hard_state'),
            Filter::expression('type', '=', 'hard_state')
        )
    );
    $data[$day] = array(
        'value'   => $value,
        'caption' => $caption,
        'url'     => $this->href('monitoring/list/eventhistory?' . $filter->toQueryString())
    );
}
$grid->setData($data);
?>
<?= $grid ?>
</div>
