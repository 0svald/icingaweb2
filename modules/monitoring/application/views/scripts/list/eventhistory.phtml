<h1>History</h1>

<?php if (!empty($history)): ?>
    <div data-icinga-component="app/mainDetailGrid">
        <?=  $this->paginationControl($history, null, null, array('preserve' => $this->preserve)); ?>
        <table class="table table-condensed">
            <tbody>
            <?php foreach ($history as $event): ?>
                <tr>
                    <td><?= date('d.m. H:i', $event->timestamp); ?></td>

                    <td>
                        <?php if (isset($event->service)): ?>
                            <a href="<?= $this->href('monitoring/show/service', array(
                                'host'    => $event->host,
                                'service' => $event->service
                            )); ?>">
                                <?= $event->service ?>
                            </a>
                        <?php else: ?>
                            <a href="<?= $this->href('monitoring/show/host', array(
                                'host'    => $event->host
                            )); ?>">
                                <?= $event->host ?>
                            </a>
                        <?php endif; ?>
                    </td>

                    <td>
                        <?php
                        switch ($event->type) {
                            case 'notify':
                                $icon   = '{{NOTIFICATION_ICON}}';
                                $title  = 'Notification';
                                $msg    = $event->output;
                                break;
                            case 'comment':
                                $icon   = '{{COMMENT_ICON}}';
                                $title  = 'Comment';
                                $msg    = $event->output;
                                break;
                            case 'ack':
                                $icon   = '{{ACKNOWLEDGEMENT_ICON}}';
                                $title  = 'Acknowledgement';
                                $msg    = $event->output;
                                break;
                            case 'dt_comment':
                                $icon   = '{{IN_DOWNTIME_ICON}}';
                                $title  = 'In Downtime';
                                $msg    = $event->output;
                                break;
                            case 'flapping':
                                $icon   = '{{FLAPPING_ICON}}';
                                $title  = 'Flapping';
                                $msg    = $event->output;
                                break;
                            case 'hard_state':
                                $icon   = '{{HARDSTATE_ICON}}';
                                $title  = 'Hard State';
                                $msg    = '[' . $event->attempt . '/' . $event->max_attempts . ']';
                                break;
                            case 'soft_state':
                                $icon   = '{{SOFTSTATE_ICON}}';
                                $title  = 'Soft State';
                                $msg    = '[' . $event->attempt . '/' . $event->max_attempts . ']';
                                break;
                            case 'dt_start':
                                $icon   = '{{DOWNTIME_START_ICON}}';
                                $title  = 'Downtime Start';
                                $msg    = $event->output;
                                break;
                            case 'dt_end':
                                $icon   = '{{DOWNTIME_END_ICON}}';
                                $title  = 'Downtime End';
                                $msg    = $event->output;
                                break;
                        }
                        ?>
                        <a href="#" title="<?= $title ?>"><i><?= $icon ?></i></a>
                        <?php if (!empty($msg)) { echo $msg; } ?>
                    </td>
                </tr>
            <? endforeach; ?>
            </tbody>
        </table>
    </div>
<?php endif; ?>
