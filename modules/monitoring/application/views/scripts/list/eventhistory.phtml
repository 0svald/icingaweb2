<div class="row">
  <div class="pull-left">
    <h1>History</h1>
  </div>
  <div class="pull-right">
    <?= $this->tabs->render($this); ?>
  </div>
</div>
<?php if (!empty($history)): ?>
    <div data-icinga-component="app/mainDetailGrid">
        <?=  $this->paginationControl($history, null, null, array('preserve' => $this->preserve)); ?>
        <table class="table table-condensed">
            <tbody>
            <?php foreach ($history as $event): ?>
                <?php
                    $class = null;
                    $isService = false;
                ?>
                <tr>
                    <td><?= date('d.m. H:i', $event->timestamp); ?></td>
                    <td>
                        <?php if (isset($event->service)): ?>
                            <a href="<?= $this->href('monitoring/show/service', array(
                                'host'    => $event->host,
                                'service' => $event->service
                            )); ?>">
                                <?= $event->service ?>
                            </a>
                            <small>
                                on <?= $event->host ?>
                            </small>
                            <?php $isService = true; ?>
                        <?php else: ?>
                            <a href="<?= $this->href('monitoring/show/host', array(
                                'host'    => $event->host
                            )); ?>">
                                <?= $event->host ?>
                            </a>
                        <?php endif; ?>
                        <br />
                        <?php
                        switch ($event->type) {
                            case 'notify':
                                $icon   = 'notification';
                                $title  = 'Notification';
                                $msg    = $event->output;
                                break;
                            case 'comment':
                                $icon   = 'comment';
                                $title  = 'Comment';
                                $msg    = $event->output;
                                break;
                            case 'ack':
                                $icon   = 'acknowledgement';
                                $title  = 'Acknowledgement';
                                $msg    = $event->output;
                                break;
                            case 'dt_comment':
                                $icon   = 'in-downtime';
                                $title  = 'In Downtime';
                                $msg    = $event->output;
                                break;
                            case 'flapping':
                                $icon   = 'flapping';
                                $title  = 'Flapping';
                                $msg    = $event->output;
                                break;
                            case 'hard_state':
                                $icon   = '{{HARDSTATE_ICON}}';
                                $title  = 'Hard State';
                                $msg    = $event->output . '<br /><small>Attempt ' . $event->attempt . '/' . $event->max_attempts . ' (Hard)</small>';
                                $class  = 'border-status-' . (
                                    $isService ?
                                    strtolower($this->util()->getServiceStateName($event->state)) :
                                    strtolower($this->util()->getHostStateName($event->state))
                                );
                                break;
                            case 'soft_state':
                                $icon   = '{{SOFTSTATE_ICON}}';
                                $title  = 'Soft State';
                                $msg    = $event->output . '<br /><small>Attempt ' . $event->attempt . '/' . $event->max_attempts . ' (Soft)</small>';
                                $class  = 'border-status-' . (
                                    $isService ?
                                    strtolower($this->util()->getServiceStateName($event->state)) :
                                    strtolower($this->util()->getHostStateName($event->state))
                                );
                                break;
                            case 'dt_start':
                                $icon   = 'downtime-start';
                                $title  = 'Downtime Start';
                                $msg    = $event->output;
                                break;
                            case 'dt_end':
                                $icon   = 'downtime-end';
                                $title  = 'Downtime End';
                                $msg    = $event->output;
                                break;
                        }
                        ?>
                        <div<?php if (!empty($class)): ?> class="<?= $class ?>"<?php endif; ?>>
                            <i title="<?= $title ?>" class="icinga-icon-<?= $icon ?>"></i>
                            <?php if (!empty($msg)) { echo $msg; } ?>
                        </div>
                    </td>
                </tr>
            <? endforeach; ?>
            </tbody>
        </table>
        <?=  $this->paginationControl($history, null, null, array('preserve' => $this->preserve)); ?>
    </div>
<?php endif; ?>
