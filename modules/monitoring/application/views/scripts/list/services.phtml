<?php
$helper = $this->getHelper('MonitoringState');
?>
<div class="controls">
<?= $this->tabs ?>
<div style="display: inline-block; margin: 1em; vertical-align: top;">
<?= $this->filterBox->render($this); ?>
</div>
<div style="display: inline-block; margin: 1em; vertical-align: top;">
<?= $this->sortControl->render($this); ?>
</div><br />
<div style="display: inline-block; margin: 1em; vertical-align: top;">
<?= $this->selectionToolbar('multi', $this->href('monitoring/multi/service', array( 'service' => '*', 'host' => '*' ))); ?></div> <?=  $this->paginationControl($services, null, null, array('preserve' => $this->preserve)); ?>
</div>

<div class="content">
<table class="action multiselect">
  <tbody>
<?php

foreach ($services as $service):
    $serviceLink = $this->href(
      'monitoring/show/service',
      array(
        'host' => $service->host_name,
        'service' => $service->service_description
      )
    );
    $hostLink = $this->href(
      'monitoring/show/host',
      array(
        'host' => $service->host_name,
      )
    );
    $serviceStateName = strtolower($this->util()->getServiceStateName($service->service_state));
?>
<!--      <tr <?= ($this->activeRowHref === $serviceLink) ? 'class="active"' : ''; ?>>-->
       <tr class="state <?= $serviceStateName ?><?= $service->service_handled ? ' handled' : '' ?>">
        <!-- Color column -->
<!--
        <td class="tacheader-status-<?= $serviceStateName; ?>">
          <a style="visibility:hidden" href="<?= $serviceLink; ?>"></a>
        </td>
        <td>
          <a style="visibility:hidden" href="<?= $serviceLink; ?>"></a>
          <?php if (!$service->service_handled && $service->service_state > 0): ?>
          <a href="#" title="Unhandled">
            <i class="icon-table icinga-icon-unhandled"></i>
          </a>
          <?php endif; ?>

          <?php if ($service->service_acknowledged && !$service->service_in_downtime): ?>
          <a href="#" title="Acknowledged">
            <i class="icon-table icinga-icon-acknowledgement"></i>
          </a>
          <?php endif; ?>

          <?php if ($service->service_is_flapping): ?>
          <a href="#" title="Flapping">
            <i class="icon-table icinga-icon-flapping"></i>
          </a>
          <?php endif; ?>

          <?php if (!$service->service_notifications_enabled): ?>
          <a href="#" title="Notifications Disabled">
            <i class="icon-table icinga-icon-notification-disabled"></i>
          </a>
          <?php endif; ?>

          <?php if ($service->service_in_downtime): ?>
          <a href="#" title="In Downtime">
            <i class="icon-table icinga-icon-in-downtime"></i>
          </a>
          <?php endif; ?>

          <?php if (!$service->service_active_checks_enabled): ?>
            <?php if (!$service->service_passive_checks_enabled): ?>
              <a href="#" title="Active And Passive Checks Disabled">
               <i class="icon-table icinga-icon-active-passive-checks-disabled"></i>
              </a>
            <?php else: ?>
              <a href="#" title="Active Checks Disabled">
               <i class="icon-table icinga-icon-active-checks-disabled"></i>
              </a>
            <?php endif; ?>
          <?php endif; ?>

          <?php if (isset($service->service_last_comment) && $service->service_last_comment !== null): ?>
          <a href="#" title="Comments">
            <i class="icon-table icinga-icon-comment"></i>
          </a>
          <?php endif; ?>
        </td>
-->
        <td class="state" title="<?= $helper->getStateTitle($service, 'service'); ?>">
            <strong><?= strtoupper($helper->monitoringState($service, 'service')); ?></strong><br />

            <div class="small-row">
              Since <?= $this->timeSince($service->service_last_state_change); ?>
              <?php if ($service->service_state): ?>
                <br />
                <strong><?= ($service->service_state_type === '1') ? 'Hard' : 'Soft'; ?> </strong>
                <?= $service->service_attempt; ?>
              <?php endif; ?>
            </div>
          </div>
        </td>

        <td title="<?= $helper->getStateTitle($service, 'host'); ?>">
        <?= $this->perfdata($service->service_perfdata, true) ?>
<!--          <?php if ($service->service_icon_image): ?>
            <div class="pull-left" style="margin-right: 2px;">
                <i class="inline-image" style="background-image: url(<?= $this->escape($this->resolveMacros($service->service_icon_image, $service)); ?>);"></i>
            </div>
          <?php endif; ?>-->
<a href="<?= $serviceLink ?>"><?= $service->service_display_name ?></a> on <a href="<?= $hostLink ?>"><?= $service->host_name; ?>
<?php if ($service->host_state != 0): ?>
  (<?= ucfirst($helper->monitoringState($service, 'host')); ?>)
<?php endif; ?>
</a><br />
          <p class="pluginoutput"><?= $this->escape(substr(strip_tags($service->service_output), 0, 10000)); ?></p>
        </td>
      </tr>
<?php endforeach; ?>
  </tbody>
</table>
</div>
