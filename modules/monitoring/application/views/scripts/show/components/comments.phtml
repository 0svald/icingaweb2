<?php

$cf = $this->getHelper('CommandForm');

$data = array('host' => $object->host_name);
if ($object->service_description) {
    $data['service'] = $object->service_description;
}

$list = array();
foreach ($object->comments as $comment) {

    // Ticket hook sample
    $text = $this->tickets ? preg_replace_callback(
        $this->tickets->getPattern(),
        array($this->tickets, 'createLink'),
        $this->escape($comment->comment_data)
    ) : $this->escape($comment->comment_data);

    $deleteData = $data;
    $deleteData['commentid'] = $object->comment_internal_id;

    $iconForm = $cf->iconSubmitForm(
        'img/icons/remove_petrol.png',
        'Remove comment',
        'link-like',
        'removecomment',
        $deleteData
    );

    $list[] = sprintf(
        "<br />%s [%s] %s (%s): %s\n",
        $iconForm,
        $this->escape($comment->comment_author),
        $this->timeSince($comment->comment_timestamp),
        $comment->comment_type,
        $text
    );
}

?>
<tr>
    <th><?= $this->translate('Comments') ?></th>
    <td>
        <a href="<?= $this->href('monitoring/command/addComment', $data) ?>"><?= $this->icon('comment_petrol.png') ?> <?= $this->translate('Add comment') ?></a>
        <?= implode('', $list) ?>
    </td>
</tr>
