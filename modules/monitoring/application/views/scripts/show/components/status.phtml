<?php

    $type = $object->type === 2 ? 'service' : 'host';

    /** @var Zend_View_Helper_CommandForm $cf */
    $cf = $this->getHelper('CommandForm');

    if ($type === 'host') {
        $objectStateName = strtolower($this->util()->getHostStateName($this->object->host_state));
        $objectState = (int) $object->host_state;
    } else {
        $objectStateName = strtolower($this->util()->getServiceStateName($this->object->service_state));
        $objectState = (int) $object->service_state;
    }
?>
<div>
    <div class="panel-body">

        <div class="panel-row">

                <?php if ($objectState > 0): ?>
                <?php if ($this->object->host_acknowledged || $this->object->service_acknowledged): ?>
                        <?= $cf->labelSubmitForm(
                            'Remove Ack',
                            'Remove problem acknowledgement',
                            'btn-cta btn-half-left',
                            'removeacknowledgement',
                            array(
                                'host'          => $this->object->host_name,
                                'service'       => $this->object->service_description
                            )
                        ) ?>
                <?php else: ?>
                    <a rel="tooltip" title="Acknowledge Problems" href="<?=
                    $this->href(
                        'monitoring/command/acknowledgeproblem',
                        array(
                            'host'      => $this->object->host_name,
                            'service'   => $this->object->service_description
                        )
                    );
                    ?>" class="button btn-cta btn-half-left">
                        Acknowledge
                    </a>
                <?php endif; ?>
                <?php endif; ?>
                
        </div>

        <?php if ($objectState > 0): ?>
        <?php
            if ($object->service_description) {
                $notificationsHref = $this->href(
                    'monitoring/list/notifications',
                    array(
                        'host'      => $object->host_name,
                        'service'   => $object->service_description
                    )
                    );
            } else {
                $notificationsHref = $this->href(
                    'monitoring/list/notifications',
                    array(
                        'host'      => $object->host_name
                    )
                );
            }
        ?>
        <div class="panel-row">
            <div class="panel-label">
                Last Notification
            </div>
            <div class="panel-content">
                <a href="<?= $notificationsHref ?>">
                    <?php if ($object->last_notification === '0000-00-00 00:00:00'): ?>
                        N/A
                    <?php else: ?>
                        <?= $object->last_notification ?>
                        <?php if ($object->current_notification_number > 0): ?>
                            <br />
                            <?= $object->current_notification_number ?> notifications sent during current problem state
                        <?php endif ;?>
                    <?php endif; ?>
                </a>
            </div>
        </div>
        <?php endif; ?>
    </div>
</div>
