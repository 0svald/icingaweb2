<div class="controls">

    <?php if (! $this->compact): ?>
        <?= $tabs; ?>
    <?php endif ?>

    <?= $this->render('list/components/servicesummary.phtml') ?>
    <br>
    <div class="hbox-item">
        <?= $this->translate('Service states:') ?>
        &nbsp;<?= $serviceStatesPieChart; ?>
    </div>
    <div class="hbox-item">
        <?= $this->translate('Host states:') ?>
        &nbsp;<?= $hostStatesPieChart; ?>
    </div>

    <?= $this->render('partials/service/objects-header.phtml'); ?>

</div>
<div class="content no-padding-top">
    <h3>
        <?= $this->icon('reschedule') ?>
        <?= $this->translate('Commands') ?>
    </h3>

    <?php if (($serviceCount = count($objects)) === 0): ?>
        <?= $this->translate('No services matching the filter'); ?>
    <?php else: ?>
        <?= sprintf($this->translatePlural(
            'Issue commands to %s selected service:',
            'Issue commands to all %s selected services:',
            count($objects)
        ), '<b>' . count($objects) . '</b>') ?>

        <p>
        <div>
            <?= $checkNowForm; ?>
        </div>

        <div>
            <?= $this->qlink(
                $this->translate('Reschedule next checks'),
                $rescheduleAllLink,
                null,
                array('icon' => 'reschedule')
            ); ?>
        </div>

        <div>
            <?= $this->qlink(
                $this->translate('Schedule downtimes'),
                $downtimeAllLink,
                null,
                array('icon' => 'plug')
            ); ?>
        </div>

        <div>
            <?= $this->qlink(
                $this->translate('Submit passive check results'),
                $processCheckResultAllLink,
                null,
                array('icon' => 'reply')
            ); ?>
        </div>

        <div>
            <?= $this->qlink(
                $this->translate('Add comments'),
                $addCommentLink,
                null,
                array('icon' => 'comment')
            ); ?>
        </div>
        </p>

        <?php
            $unhandledCount = count($unhandledObjects);
            $problemCount = count($problemObjects);
        ?>

        <?php if ($problemCount || $unhandledCount): ?>
        <div>
            <h3>
                <?= $this->icon('attention-alt') ?>
                <?= $this->translate('Problems') ?>
            </h3>

            <?php if ($problemCount): ?>
                <p>
                    <?= sprintf(
                        $this->translatePlural(
                            'There is %s problem, issue commands to the problem service',
                            'There are %s problems, issue commands to the problem services',
                            $problemCount
                        ),
                        '<b>' . $problemCount . '</b>'
                    ); ?>

                <div>
                    <?= $this->qlink(
                        sprintf(
                            $this->translatePlural(
                                'Schedule a downtime for %s problem service',
                                'Schedule downtimes for %s problem services',
                                $problemCount
                            ),
                            $problemCount
                        ),
                        $downtimeLink,
                        null,
                        array('icon' => 'plug')
                    ); ?>
                </div>
            <?php endif ?>

            <?php if ($unhandledCount): ?>
                <p><?= sprintf($this->translate('There are %s unhandled problems. ' .
                        'Issue commands to the problematic services:'),
                        '<span class="badge badge-critical">' . $unhandledCount . '</span>') ?>
                    <div>
                    <?= $this->qlink(
                        sprintf(
                            $this->translatePlural(
                                'Schedule a downtime for %u unhandled service problem',
                                'Schedule a downtime for %u unhandled service problems',
                                $unhandledCount
                            ),
                            $unhandledCount
                        ),
                        $downtimeUnhandledLink,
                        null,
                        array('icon' => 'plug')
                    ); ?>
                    </div>

                    <div><?= $this->qlink(
                        sprintf(
                            $this->translatePlural(
                                'Acknowledge %u unhandled service problem',
                                'Acknowledge %u unhandled service problems',
                                $unhandledCount
                            ),
                            $unhandledCount
                        ),
                        $acknowledgeUnhandledLink,
                        null,
                        array('icon' => 'ok')
                    ); ?></div>
                </p>
            <?php endif ?>

        </div>
        <?php endif; ?>

    <?php if (($acknowledgedCount = count($acknowledgedObjects)) > 0): ?>
        <h3><?= $this->icon('ok', $this->translate('Acknowledgements')) ?> <?= $this->translate('Acknowledgements') ?></h3>
        <p>
            <?= sprintf(
                $this->translatePlural(
                    '%s Acknowledged Service Problem.',
                    '%s Acknowledged Service Problems.',
                    $acknowledgedCount
                ),
                '<b>' . $acknowledgedCount . '</b>'
            ); ?> <?= $removeAckForm ?>
        </p>
    <?php endif ?>


    <?php if (($inDowntimeCount = count($objectsInDowntime)) > 0 /*&& $auth->hasPermission('monitoring/command/comment/delete')*/): ?>
        <h3>  <?= $this->icon('plug', $this->translate('Downtimes')) ?> <?= $this->translate('Downtimes') ?>  </h3>
        <p> <?= sprintf($this->translatePlural(
                '%s service currently in downtime.',
                '%s services currently in downtime.',
                $inDowntimeCount
            ), '<b>' . $inDowntimeCount . '</b>') ?>

            <?= $this->qlink(
                $this->translate('List all'),
                $inDowntimeLink,
                null,
                array('data-base-target' => '_next')
            );?>
        </p>
    <?php endif ?>


<?php $commentCount = count($objects->getComments()) ?>
<?php if ($commentCount > 0): ?>
    <h3> <?= $this->icon('comment') ?> <?= $this->translate('Comments') ?> </h3>
    <p><?= sprintf(
            $this->translatePlural(
                'There is %s comment.',
                'There are %s comments.',
                $commentCount
            ), '<b>' . $commentCount . '</b>');
    ?>
    <?= $this->qlink(
        $this->translate('List all'),
        $commentsLink,
        null,
        array('data-base-target' => '_next')
    ); ?>
    <p>

    <!--
    </p>
    <div><?= $this->qlink(
            $this->translate('Remove all'),
            $deleteCommentLink,
            null,
            array('icon' => 'trash')
    ); ?></div>
    </p>
    -->

    <?php endif ?>

    <?php endif ?>
</div>
